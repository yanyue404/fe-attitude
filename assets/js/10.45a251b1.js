(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{322:function(t,a,s){t.exports=s.p+"assets/img/babel-complie.62437165.png"},352:function(t,a,s){"use strict";s.r(a);var e=s(29),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"工程化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#工程化"}},[t._v("#")]),t._v(" 工程化")]),t._v(" "),a("h2",{attrs:{id:"webpack-常见-loader-和-plugin-有哪些-二者的区别是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack-常见-loader-和-plugin-有哪些-二者的区别是什么"}},[t._v("#")]),t._v(" webpack 常见 loader 和 plugin 有哪些？二者的区别是什么？")]),t._v(" "),a("h3",{attrs:{id:"常见-loader"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见-loader"}},[t._v("#")]),t._v(" 常见 loader")]),t._v(" "),a("p",[t._v("在 webpack 文档里写了：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://webpack.js.org/loaders/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Loaders | webpack"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("你可以记住：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("babel-loader")]),t._v(" 把 JS/TS（ES6） 变成 JS（ES5）")]),t._v(" "),a("li",[a("code",[t._v("ts-loader")]),t._v(" 把 TS 变成 JS，"),a("strong",[t._v("并提示类型错误")])]),t._v(" "),a("li",[a("code",[t._v("markdown-loader")]),t._v(" 把 markdown 变成 html")]),t._v(" "),a("li",[a("code",[t._v("html-loader")]),t._v(" 把 html 变成 JS 字符串")]),t._v(" "),a("li",[a("code",[t._v("sass-loader")]),t._v(" 把 SASS/SCSS 变成 CSS")]),t._v(" "),a("li",[a("code",[t._v("css-loader")]),t._v(" 把 CSS 变成 JS 字符串")]),t._v(" "),a("li",[a("code",[t._v("style-loader")]),t._v(" 把 JS 字符串变成 style 标签")]),t._v(" "),a("li",[a("code",[t._v("postcss-loader")]),t._v(" 把 CSS 变成更优化的 CSS")]),t._v(" "),a("li",[a("code",[t._v("vue-loader")]),t._v(" 把单文件组件（SFC）变成 JS 模块")]),t._v(" "),a("li",[a("code",[t._v("file-loader")]),t._v(" 把文件输出到一个文件夹中，在代码中通过相对 URL 去引用输出的文件")]),t._v(" "),a("li",[a("code",[t._v("url-loader")]),t._v(" 和 file-loader 类似，但是能在文件很小的情况下以 base64 的方式把文件内容注入到代码中去")]),t._v(" "),a("li",[a("code",[t._v("eslint-loader")]),t._v(" 通过 ESLint 检查 JavaScript 代码规范，"),a("strong",[t._v("并提示类型错误")])]),t._v(" "),a("li",[a("code",[t._v("thread-loader")]),t._v(" 用于多进程打包")]),t._v(" "),a("li",[a("code",[t._v("source-map-loader")]),t._v(" 加载额外的 Source Map 文件，以方便代码调试")])]),t._v(" "),a("h3",{attrs:{id:"常见-plugin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见-plugin"}},[t._v("#")]),t._v(" 常见 plugin")]),t._v(" "),a("p",[t._v("也在 webpack 文档里写了：")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://webpack.js.org/plugins/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Plugins | webpack"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("你可以记住这些：")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("UglifyJsPlugin")]),t._v(" 压缩和混淆代码")]),t._v(" "),a("li",[a("code",[t._v("html-webpack-plugin")]),t._v(" 用于创建 HTML 页面并自动引入 JS 和 CSS")]),t._v(" "),a("li",[a("code",[t._v("clean-webpack-plugin")]),t._v(" 用于清理之前打包的残余文件")]),t._v(" "),a("li",[a("code",[t._v("mini-css-extract-plugin")]),t._v(" 用于将 JS 中的 CSS 抽离成单独的 CSS 文件")]),t._v(" "),a("li",[a("code",[t._v("HotModuleReplacementPlugin")]),t._v(" 热跟新")]),t._v(" "),a("li",[a("code",[t._v("SplitChunksPlugin")]),t._v(" 用于代码分包（Code Split）")]),t._v(" "),a("li",[a("code",[t._v("DllPlugin")]),t._v(" + "),a("code",[t._v("DllReferencePlugin")]),t._v(" 用于避免大依赖被频繁重新打包，大幅降低打包时间\n"),a("ul",[a("li",[a("a",{attrs:{href:"https://segmentfault.com/a/1190000016567986",target:"_blank",rel:"noopener noreferrer"}},[t._v("webpack 使用-详解 DllPlugin"),a("OutboundLink")],1)])])]),t._v(" "),a("li",[a("code",[t._v("CommonsChunkPlugin")]),t._v(" 提高打包效率，将第三方库和业务代码分开打包")]),t._v(" "),a("li",[a("code",[t._v("DefinePlugin")]),t._v(" 用于在 webpack config 里添加全局变量")]),t._v(" "),a("li",[a("code",[t._v("copy-webpack-plugin")]),t._v(" 用于拷贝静态文件到 dist")]),t._v(" "),a("li",[a("code",[t._v("webpack-bundle-analyzer")]),t._v(" 代码分析；")])]),t._v(" "),a("h3",{attrs:{id:"二者的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二者的区别"}},[t._v("#")]),t._v(" 二者的区别")]),t._v(" "),a("ul",[a("li",[t._v("loader 是文件加载器，让 webpack 拥有加载和解析非 JavaScript 文件的能力\n"),a("ul",[a("li",[t._v("功能：能够对文件进行编译、优化、混淆（压缩）等，比如 babel-loader / vue-loader")]),t._v(" "),a("li",[t._v("运行时机：在创建最终产物之前运行")])])]),t._v(" "),a("li",[t._v("plugin 是 webpack 插件（这句废话也很重要）\n"),a("ul",[a("li",[t._v("功能：能实现更多功能，比如定义全局变量、Code Split、加速编译等 （基于事件机制工作，会监听 webpack 打包过程中的某些事件，执行改变输出结果的任务）")]),t._v(" "),a("li",[t._v("运行时机：在整个打包过程（以及前后）都能运行")])])])]),t._v(" "),a("h2",{attrs:{id:"webpack-怎么写一个-plugin-和-loader"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack-怎么写一个-plugin-和-loader"}},[t._v("#")]),t._v(" webpack 怎么写一个 plugin 和 loader")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/woai3c/Front-end-articles/issues/6",target:"_blank",rel:"noopener noreferrer"}},[t._v("实现一个 webpack loader 和 webpack plugin"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"babel-的原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#babel-的原理"}},[t._v("#")]),t._v(" Babel 的原理")]),t._v(" "),a("blockquote",[a("p",[t._v("查看 AST https://astexplorer.net/")])]),t._v(" "),a("p",[t._v("Babel 是 JavaScript 编译器：他能让开发者在开发过程中，直接使用各类方言（如 TS、Flow、JSX）或新的语法特性，而不需要考虑运行环境，因为 Babel 可以做到按需转换为低版本支持的代码；Babel 内部原理是将 JS 代码转换为 AST，对 AST 应用各种插件进行处理，最终输出编译后的 JS 代码。")]),t._v(" "),a("p",[a("strong",[t._v("Babel 编译流程")])]),t._v(" "),a("p",[t._v("三大步骤")]),t._v(" "),a("p",[a("img",{attrs:{src:s(322),alt:""}})]),t._v(" "),a("ol",[a("li",[a("p",[t._v("解析阶段：Babel 默认使用  @babel/parser  将代码转换为 AST。解析一般分为两个阶段：词法分析和语法分析。")]),t._v(" "),a("ul",[a("li",[t._v("词法分析：对输入的字符序列做标记化(tokenization)操作。")]),t._v(" "),a("li",[t._v("语法分析：处理标记与标记之间的关系，最终形成一颗完整的 AST 结构。")])])]),t._v(" "),a("li",[a("p",[t._v("转换阶段：Babel 使用  @babel/traverse  提供的方法对 AST 进行深度优先遍历，调用插件对关注节点的处理函数，按需对 AST 节点进行增删改操作。")])]),t._v(" "),a("li",[a("p",[t._v("生成阶段：Babel 默认使用  @babel/generator  将上一阶段处理后的 AST 转换为代码字符串。")])])]),t._v(" "),a("h2",{attrs:{id:"webpack-如何解决开发时的跨域问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack-如何解决开发时的跨域问题"}},[t._v("#")]),t._v(" webpack 如何解决开发时的跨域问题？")]),t._v(" "),a("p",[t._v("在开发时，我们的页面在 "),a("code",[t._v("localhost:8080")]),t._v("，JS 直接访问后端接口（如 "),a("code",[t._v("https://xiedaimala.com")]),t._v(" 或 "),a("code",[t._v("http://localhost:3000")]),t._v("）会报跨域错误。")]),t._v(" "),a("p",[t._v("为了解决这个问题，可以在 webpack.config.js 中添加如下配置：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//...")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("devServer")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("proxy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'/api'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("target")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://xiedaimala.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("changeOrigin")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("此时，在 JS 中请求 "),a("code",[t._v("/api/users")]),t._v(" 就会自动被代理到 "),a("code",[t._v("http://xiedaimala.com/api/users")]),t._v(" 。")]),t._v(" "),a("p",[t._v("如果希望请求中的 Origin 从 8080 修改为 xiedaimala.com，可以添加 "),a("code",[t._v("changeOrigin: true")]),t._v(" 。")]),t._v(" "),a("p",[t._v("如果要访问的是 HTTPS API，那么就需要配置 HTTPS 证书，否则会报错。")]),t._v(" "),a("p",[t._v("不过，如果在 target 下面添加 "),a("code",[t._v("secure: false")]),t._v(" ，就可以不配置证书且忽略 HTTPS 报错。")]),t._v(" "),a("h3",{attrs:{id:"工作原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#工作原理"}},[t._v("#")]),t._v(" 工作原理")]),t._v(" "),a("p",[a("code",[t._v("proxy")]),t._v("工作原理实质上是利用"),a("code",[t._v("http-proxy-middleware")]),t._v("  这个"),a("code",[t._v("http")]),t._v("代理中间件，实现请求转发给其他服务器")]),t._v(" "),a("p",[t._v("举个例子：")]),t._v(" "),a("p",[t._v("在开发阶段，本地地址为"),a("code",[t._v("http://localhost:3000")]),t._v("，该浏览器发送一个前缀带有"),a("code",[t._v("/api")]),t._v("标识的请求到服务端获取数据，但响应这个请求的服务器只是将请求转发到另一台服务器中")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" express "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'express'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" proxy "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http-proxy-middleware'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("express")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/api'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("proxy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("target")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://www.example.org'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("changeOrigin")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\napp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// http://localhost:3000/api/foo/bar -> http://www.example.org/api/foo/bar")]),t._v("\n")])])]),a("h3",{attrs:{id:"跨域"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域"}},[t._v("#")]),t._v(" 跨域")]),t._v(" "),a("p",[t._v("在开发阶段， "),a("code",[t._v("webpack-dev-server")]),t._v("  会启动一个本地开发服务器，所以我们的应用在开发阶段是独立运行在  "),a("code",[t._v("localhost")]),t._v("的一个端口上，而后端服务又是运行在另外一个地址上")]),t._v(" "),a("p",[t._v("所以在开发阶段中，由于浏览器同源策略的原因，当本地访问后端就会出现跨域请求的问题")]),t._v(" "),a("p",[t._v("通过设置"),a("code",[t._v("webpack proxy")]),t._v("实现代理请求后，相当于浏览器与服务端中添加一个代理者")]),t._v(" "),a("p",[t._v("当本地发送请求的时候，代理服务器响应该请求，并将请求转发到目标服务器，目标服务器响应数据后再将数据返回给代理服务器，最终再由代理服务器将数据响应给本地")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://static.vue-js.com/65b5e5c0-ace5-11eb-85f6-6fac77c0c9b3.png",alt:""}})]),t._v(" "),a("p",[t._v("在代理服务器传递数据给本地浏览器的过程中，两者同源，并不存在跨域行为，这时候浏览器就能正常接收数据")]),t._v(" "),a("p",[t._v("注意：服务器与服务器之间请求数据并不会存在跨域行为，跨域行为是浏览器安全策略限制")]),t._v(" "),a("p",[a("strong",[t._v("参考文献")])]),t._v(" "),a("ul",[a("li",[t._v("https://vue3js.cn/interview/webpack/proxy.htm")]),t._v(" "),a("li",[t._v("https://webpack.docschina.org/configuration/dev-server/#devserverproxy")])]),t._v(" "),a("h2",{attrs:{id:"webpack-如何实现-tree-shaking"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack-如何实现-tree-shaking"}},[t._v("#")]),t._v(" webpack 如何实现 tree-shaking？")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://webpack.js.org/guides/tree-shaking/#conclusion",target:"_blank",rel:"noopener noreferrer"}},[t._v("Tree Shaking | webpack"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://webpack.docschina.org/guides/tree-shaking/#conclusion",target:"_blank",rel:"noopener noreferrer"}},[t._v("Tree Shaking | webpack 中文文档"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#是什么"}},[t._v("#")]),t._v(" 是什么")]),t._v(" "),a("p",[t._v("tree-shaking 就是让没有用到的 JS 代码不打包，以减小包的体积。")]),t._v(" "),a("h3",{attrs:{id:"怎么做"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#怎么做"}},[t._v("#")]),t._v(" 怎么做")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("怎么删")]),t._v(" "),a("ol",[a("li",[t._v("使用 ES Modules 语法（即 ES6 的 import 和 export 关键字）")]),t._v(" "),a("li",[t._v("CommonJS 语法无法 tree-shaking（即 require 和 exports 语法）\n"),a("ul",[a("li",[t._v("需要给 bebel-loader 添加 "),a("code",[t._v("modules: false")]),t._v(" 选项（避免 babel 将 js 自动编译为 CommonJS ）")])])]),t._v(" "),a("li",[t._v("引入的时候只引用需要的模块\n"),a("ul",[a("li",[t._v("要写 "),a("code",[t._v("import {cloneDeep} from 'lodash-es'")]),t._v(" 因为方便 tree-shaking")]),t._v(" "),a("li",[t._v("不要写 "),a("code",[t._v("import _ from 'lodash'")]),t._v(" 因为会导致无法 tree-shaking 无用模块")])])])])]),t._v(" "),a("li",[a("p",[t._v("怎么不删：在 package.json 中配置 "),a("code",[t._v("sideEffects")]),t._v("，防止某些文件被删掉")]),t._v(" "),a("ol",[a("li",[t._v("比如我 import 了 x.js，而 x.js 只是添加了 "),a("code",[t._v("window.x")]),t._v(" 属性，那么 x.js 就要放到 sideEffects 里")]),t._v(" "),a("li",[t._v("比如所有被 import 的 CSS 都要放在 sideEffects 里")])])]),t._v(" "),a("li",[a("p",[t._v("怎么开启：在 webpack config 中将 mode 设置为 production（开发环境没必要 tree-shaking）")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("mode: production")]),t._v(" 给 webpack 加了非常多"),a("a",{attrs:{href:"https://github.com/webpack/webpack/blob/f43047c4c2aa4b0a315328e4c34a319dc2662254/lib/config/defaults.js#L1125",target:"_blank",rel:"noopener noreferrer"}},[t._v("优化"),a("OutboundLink")],1),t._v("。")])])])]),t._v(" "),a("p",[t._v("原理： tree-shaking 通过静态分析，对代码进行扫描分析，经过词法分析、语法分析、AST 树等分析手段，识别未被引用的代码，标记为冗余代码，真正剔除操作一般是 uglifyjs 模块。")]),t._v(" "),a("h2",{attrs:{id:"webpack-热更新原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack-热更新原理"}},[t._v("#")]),t._v(" webpack 热更新原理")]),t._v(" "),a("p",[t._v("webpack 在热更新模式下，启动服务后，服务端会与客户端建立一个长连接（websocket）。文件修改后，服务端会通过长链接向客户端推送一条消息，客户端收到后，会重新请求一个 js 文件，返回的 js 文件会调用 webpackHotUpdatehmr 方法，用于替换掉 "),a("strong",[t._v("webpack_modules")]),t._v(" 中的部分代码。")]),t._v(" "),a("ol",[a("li",[t._v("webpack-dev-server 启动本地服务，与 Client 建立长连接")]),t._v(" "),a("li",[t._v("Webpack 监听文件修改，修改后通过长连接通知客户端；")]),t._v(" "),a("li",[t._v("Client 重新请求文件，替换 "),a("strong",[t._v("webpack_modules")]),t._v(" 中对应部分")])]),t._v(" "),a("p",[t._v("首先，介绍 webpack-dev-server:"),a("br"),t._v("\nwebpack-dev-server 主要包含了三个部分："),a("br"),t._v("\n1.webpack: 负责编译代码"),a("br"),t._v("\n2.webpack-dev-middleware: 主要负责构建内存文件系统，把 webpack 的 OutputFileSystem 替换成 InMemoryFileSystem。同时作为 Express 的中间件拦截请求，从内存文件系统中把结果拿出来。"),a("br"),t._v("\n3.express：负责搭建请求路由服务。")]),t._v(" "),a("p",[t._v("其次，介绍工作流程:"),a("br"),t._v("\n1.启动 dev-server，webpack 开始构建，在编译期间会向 entry 文件注入热更新代码；"),a("br"),t._v("\n2.Client 首次打开后，Server 和 Client 基于 Socket 建立通讯渠道；"),a("br"),t._v('\n3.修改文件，Server 端监听文件发送变动，webpack 开始编译，直到编译完成会触发"Done"事件；'),a("br"),t._v("\n4.Server 通过 socket 发送消息告知 Client；"),a("br"),t._v("\n5.Client 根据 Server 的消息（hash 值和 state 状态），通过 ajax 请求获取 Server 的 manifest 描述文件；"),a("br"),t._v("\n6.Client 对比当前 modules tree ，再次发请求到 Server 端获取新的 JS 模块；"),a("br"),t._v("\n7.Client 获取到新的 JS 模块后，会更新 modules tree 并替换掉现有的模块；"),a("br"),t._v("\n8.最后调用 module.hot.accept() 完成热更新；")]),t._v(" "),a("h2",{attrs:{id:"如何利用-webpack-来优化前端性能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何利用-webpack-来优化前端性能"}},[t._v("#")]),t._v(" 如何利用 webpack 来优化前端性能")]),t._v(" "),a("p",[t._v("webpack 做性能优化主要是考虑打包体积和打包速度。")]),t._v(" "),a("p",[t._v("打包体积分析用 "),a("code",[t._v("webpack-bundle-analyzer")]),t._v(" 插件，速度分析用："),a("code",[t._v("speed-measure-webpack-plugin")]),t._v(" 插件。")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/yanyue404/blog/issues/241",target:"_blank",rel:"noopener noreferrer"}},[t._v("从前端工程的角度进行性能优化"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"如何提高-webpack-构建速度"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何提高-webpack-构建速度"}},[t._v("#")]),t._v(" 如何提高 webpack 构建速度？")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://webpack.docschina.org/guides/build-performance/",target:"_blank",rel:"noopener noreferrer"}},[t._v("构建性能 | webpack 中文文档"),a("OutboundLink")],1)]),t._v(" "),a("ol",{attrs:{start:"0"}},[a("li",[t._v("speed-measure-webpack-plugin 分析构建时间")]),t._v(" "),a("li",[t._v("externals 拆包采用 cdn 方式引入 vue, vue-router 及组件库")]),t._v(" "),a("li",[t._v("使用 DllPlugin 将不常变化的 node_modules 代码提前打包，并复用，如 echarts 下选用的模块")]),t._v(" "),a("li",[t._v("使用 thread-loader 进行多线程打包，加速耗时的 loader （例如 babel-loader）")]),t._v(" "),a("li",[t._v("处于开发环境时，在 webpack config 中 使用 cache-loader 加速 Vue/Babel/TypeScript 编译开启缓存")]),t._v(" "),a("li",[t._v("import 优化，运用这个插件（babel-plugin-dynamic-import-node）能在代码使用了 import 语法的情况下，大大提高代码的编译速度。")]),t._v(" "),a("li",[t._v("处于生产环境时，关闭不必要的环节，比如可以关闭 source map")]),t._v(" "),a("li",[t._v("网传的 HardSourceWebpackPlugin 已经一年多没更新了，谨慎使用")])]),t._v(" "),a("h2",{attrs:{id:"webpack-能做哪些性能优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack-能做哪些性能优化"}},[t._v("#")]),t._v(" webpack 能做哪些性能优化")]),t._v(" "),a("ol",[a("li",[t._v("压缩代码")]),t._v(" "),a("li",[t._v("tree-shaking")]),t._v(" "),a("li",[t._v("根据文件内容生成 hash 当作文件名，配合 CDN 做文件缓存")]),t._v(" "),a("li",[t._v("分割代码，按需加载")]),t._v(" "),a("li",[t._v("将第三方插件或公共代码单独提取出来打包")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.cn/post/6844903651291447309",target:"_blank",rel:"noopener noreferrer"}},[t._v("三十分钟掌握 Webpack 性能优化"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"webpack-模块加载原理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack-模块加载原理"}},[t._v("#")]),t._v(" webpack 模块加载原理")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.cn/post/6872354325553741838",target:"_blank",rel:"noopener noreferrer"}},[t._v("深入了解 webpack 模块加载原理"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"webpack-的构建流程是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack-的构建流程是什么"}},[t._v("#")]),t._v(" webpack 的构建流程是什么")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://juejin.cn/post/6844904000169607175",target:"_blank",rel:"noopener noreferrer"}},[t._v("webpack 构建流程分析"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"webpack-的分包策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack-的分包策略"}},[t._v("#")]),t._v(" webpack 的分包策略")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://panjiachen.github.io/awesome-bookmarks/blog/webpack/webpack4-b.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("webpack 的分包策略"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"webpack-与-vite-的区别是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack-与-vite-的区别是什么"}},[t._v("#")]),t._v(" webpack 与 vite 的区别是什么？")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("开发环境区别")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("vite 自己实现 server，不对代码打包，充分利用浏览器对 "),a("code",[t._v("<script type=module>")]),t._v(" 的支持")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("假设 main.js 引入了 vue")])]),t._v(" "),a("li",[a("p",[t._v("该 server 会把 "),a("code",[t._v("import { createApp } from 'vue'")]),t._v(" 改为 "),a("code",[t._v('import { createApp } from "/node_modules/.vite/vue.js"')]),t._v(" 这样浏览器就知道去哪里找 vue.js 了")])])])]),t._v(" "),a("li",[a("p",[t._v("webpack-dev-server 常使用 babel-loader 基于内存打包，比 vite 慢很多很多很多")]),t._v(" "),a("ol",[a("li",[t._v("该 server 会把 vue.js 的代码（递归地）打包进 main.js")])])])])]),t._v(" "),a("li",[a("p",[t._v("生产环境区别")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("vite 使用 rollup + esbuild 来打包 JS 代码")])]),t._v(" "),a("li",[a("p",[t._v("webpack 使用 babel 来打包 JS 代码，比 esbuild 慢很多很多很多")]),t._v(" "),a("ol",[a("li",[t._v("webpack 能使用 esbuild 吗？可以，你要自己配置（很麻烦）。")])])])])]),t._v(" "),a("li",[a("p",[t._v("文件处理时机")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("vite 只会在你请求某个文件的时候处理该文件")])]),t._v(" "),a("li",[a("p",[t._v("webpack 会提前打包好 main.js，等你请求的时候直接输出打包好的 JS 给你")])])])])]),t._v(" "),a("p",[t._v("目前已知 vite 的缺点有：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("热更新常常失败，原因不清楚（F5, ctrl + R）")])]),t._v(" "),a("li",[a("p",[t._v("有些功能 rollup 不支持，需要自己写 rollup 插件")])]),t._v(" "),a("li",[a("p",[t._v("不支持非现代浏览器（浏览器需要支持"),a("code",[t._v("<script type=module>")]),t._v(" ）")])])]),t._v(" "),a("h2",{attrs:{id:"webpack-和-rollup-的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack-和-rollup-的区别"}},[t._v("#")]),t._v(" webpack 和 rollup 的区别")]),t._v(" "),a("p",[t._v("rollup 从设计之初就是面向 ES module 的，它诞生时 AMD、CMD、UMD 的格式之争还很火热，作者希望充分利用 ES module 机制，构建出结构扁平，性能出众的类库.")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// rollup.config.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" resolve "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rollup-plugin-node-resolve'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" commonjs "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rollup-plugin-commonjs'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" babel "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rollup-plugin-babel'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("input")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'src/index.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("output")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("file")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/bundle.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("format")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'umd'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("plugins")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("commonjs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("babel")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("exclude")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node_modules/**'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),a("p",[t._v("webpack 致力于复杂 SPA 的模块化构建，优势在于：")]),t._v(" "),a("ol",[a("li",[t._v("通过 loader 处理各种各样的资源依赖")]),t._v(" "),a("li",[t._v("HMR 模块热替换")]),t._v(" "),a("li",[t._v("代码按需加载")]),t._v(" "),a("li",[t._v("提取公共模块")])]),t._v(" "),a("p",[t._v("rollup 致力于打造性能出众的类库，有如下优势：")]),t._v(" "),a("ol",[a("li",[t._v("编译出来的代码"),a("code",[t._v("可读性好")])]),t._v(" "),a("li",[t._v("rollup 打包后生成的 bundle 内容十分"),a("code",[t._v("干净")]),t._v("，没有什么多余的代码。相比 webpack(webpack 打包后会生成"),a("strong",[t._v("webpack_require")]),t._v("等 runtime 代码)，rollup 拥有无可比拟的性能优势，这是由依赖处理方式决定的，"),a("code",[t._v("编译时依赖处理（rollup）自然比运行时依赖处理（webpack）性能更好")])]),t._v(" "),a("li",[t._v("对于 ES 模块依赖库，rollup 会静态分析代码中的 import，并将排除任何未实际使用的代码")]),t._v(" "),a("li",[t._v("支持程序流分析，能更加正确的判断项目本身的代码是否有副作用(配合 tree-shaking)")]),t._v(" "),a("li",[t._v("支持导出"),a("code",[t._v("es")]),t._v("模块文件（webpack 不支持导出 es 模块）")])]),t._v(" "),a("p",[t._v("参考资料：")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/75717476",target:"_blank",rel:"noopener noreferrer"}},[t._v("【第九期】Rollup：下一代 ES 模块打包工具"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("http://www.caoyuanpeng.com/Webpack/rollup跟webpack打包的区别.html")])]),t._v(" "),a("h2",{attrs:{id:"webpack-怎么配置多页应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack-怎么配置多页应用"}},[t._v("#")]),t._v(" webpack 怎么配置多页应用？")]),t._v(" "),a("p",[t._v("这是对应的 webpack config：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" HtmlWebpackPlugin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'html-webpack-plugin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("entry")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./src/app.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("admin")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./src/admin.js'")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("plugins")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HtmlWebpackPlugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("filename")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index.html'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("chunks")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'app'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HtmlWebpackPlugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("filename")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'admin.html'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("chunks")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'admin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("但是，这样配置会有一个「重复打包」的问题：假设 app.js 和 admin.js 都引入了 vue.js，那么 vue.js 的代码既会打包进 app.js，也会打包进 admin.js。我们需要使用 "),a("code",[t._v("optimization.splitChunks")]),t._v(" 将共同依赖单独打包成 common.js（HtmlWebpackPlugin 会自动引入 common.js）。")]),t._v(" "),a("h3",{attrs:{id:"webpack-如何支持无限多页面呢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webpack-如何支持无限多页面呢"}},[t._v("#")]),t._v(" webpack 如何支持无限多页面呢？")]),t._v(" "),a("p",[t._v("写点 Node.js 代码不就实现了么？")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" HtmlWebpackPlugin "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'html-webpack-plugin'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'fs'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" filenames "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fs\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readdirSync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./src/pages'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("endsWith")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("basename")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("file"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" entries "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" filenames"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("reduce")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("./src/pages/")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v(".js")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" plugins "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" filenames"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HtmlWebpackPlugin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("filename")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.html'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("chunks")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("entry")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("entries\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("plugins")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("plugins"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h2",{attrs:{id:"swc、esbuild-是什么"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#swc、esbuild-是什么"}},[t._v("#")]),t._v(" swc、esbuild 是什么？")]),t._v(" "),a("h3",{attrs:{id:"swc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#swc"}},[t._v("#")]),t._v(" swc")]),t._v(" "),a("p",[t._v("实现语言：Rust")]),t._v(" "),a("p",[t._v("功能：编译 JS/TS、打包 JS/TS")]),t._v(" "),a("p",[t._v("优势：比 babel 快很多很多很多（20 倍以上）")]),t._v(" "),a("p",[t._v("能否集成进 webpack：能")]),t._v(" "),a("p",[t._v("使用者：Next.js、Parcel、Deno、Vercel、ByteDance、Tencent、Shopify……")]),t._v(" "),a("p",[t._v("做不到：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("对 TS 代码进行类型检查（用 tsc 可以）")])]),t._v(" "),a("li",[a("p",[t._v("打包 CSS、SVG")])])]),t._v(" "),a("h3",{attrs:{id:"esbuild"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#esbuild"}},[t._v("#")]),t._v(" esbuild")]),t._v(" "),a("p",[t._v("实现语言：Go")]),t._v(" "),a("p",[t._v("功能：同上")]),t._v(" "),a("p",[t._v("优势：比 babel 快很多很多很多很多很多很多（10~100 倍）")]),t._v(" "),a("p",[t._v("能否集成进 webpack：能")]),t._v(" "),a("p",[t._v("使用者：vite、vuepress、snowpack、umijs、blitz.js 等")]),t._v(" "),a("p",[t._v("做不到：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("对 TS 代码进行类型检查")])]),t._v(" "),a("li",[a("p",[t._v("打包 CSS、SVG")])])]),t._v(" "),a("h2",{attrs:{id:"谈谈对于工程化的理解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#谈谈对于工程化的理解"}},[t._v("#")]),t._v(" 谈谈对于工程化的理解")]),t._v(" "),a("p",[t._v("前端工程化，其实是软件工程在前端方面的应用。什么是软件工程？百度百科的定义：")]),t._v(" "),a("p",[t._v("软件工程是一门研究用工程化方法构建和维护有效的、使用的和高质量的软件的学科。")]),t._v(" "),a("p",[t._v("换句话说，工程化的目的就是为了提升团队的开发效率。例如大家所熟悉的构建打包、性能优化、自动化部署等知识，都属于工程化的内容。")]),t._v(" "),a("h3",{attrs:{id:"重要的几个概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重要的几个概念"}},[t._v("#")]),t._v(" 重要的几个概念")]),t._v(" "),a("p",[t._v("1、模块化：JS 的模块化、css 的模块化、资源的模块化（模块化是在文件层面上，对代码或资源的拆分）")]),t._v(" "),a("p",[t._v("2、组件化：组件化是在设计层面上，对 UI（用户界面）的拆分，组件化更重要是一种分治思想，封装组件需要注意组件之间的依赖关系（继承、扩展、嵌套）")]),t._v(" "),a("p",[t._v("3、规范化：编码规范、前后端接口规范、文档规范、组件规范、git 分支管理、commit 描述规范...")]),t._v(" "),a("p",[t._v("4、自动化：雪碧图、持续集成、自动化构建、自动化部署、自动化测试（任何简单机械的重复劳动都应该让机器去完成）")]),t._v(" "),a("h3",{attrs:{id:"目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目录"}},[t._v("#")]),t._v(" 目录")]),t._v(" "),a("ol",[a("li",[t._v("技术选型：如何进行技术选型？")]),t._v(" "),a("li",[t._v("统一规范")]),t._v(" "),a("li",[t._v("模块化、组件化")]),t._v(" "),a("li",[t._v("构建工具")]),t._v(" "),a("li",[t._v("自动化")]),t._v(" "),a("li",[t._v("性能优化")]),t._v(" "),a("li",[t._v("监控")]),t._v(" "),a("li",[t._v("重构")]),t._v(" "),a("li",[t._v("项目拆分")]),t._v(" "),a("li",[t._v("测试")]),t._v(" "),a("li",[t._v("创造性")])]),t._v(" "),a("p",[t._v("参考")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/yanyue404/blog/issues/244",target:"_blank",rel:"noopener noreferrer"}},[t._v("yanyue404 - 对前端工程化的理解"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("https://woai3c.gitee.io/introduction-to-front-end-engineering/")])]),t._v(" "),a("h2",{attrs:{id:"性能优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#性能优化"}},[t._v("#")]),t._v(" 性能优化")]),t._v(" "),a("blockquote",[a("p",[t._v("我的优化策略："),a("a",{attrs:{href:"https://github.com/yanyue404/blog/issues/241",target:"_blank",rel:"noopener noreferrer"}},[t._v("从前端工程的角度进行性能优化"),a("OutboundLink")],1)])]),t._v(" "),a("h3",{attrs:{id:"如何在-h5-和小程序项目中计算白屏时间和首屏时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何在-h5-和小程序项目中计算白屏时间和首屏时间"}},[t._v("#")]),t._v(" 如何在 H5 和小程序项目中计算白屏时间和首屏时间")]),t._v(" "),a("blockquote",[a("p",[t._v("https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/272")])]),t._v(" "),a("h3",{attrs:{id:"前端项目如何找出性能瓶颈"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端项目如何找出性能瓶颈"}},[t._v("#")]),t._v(" 前端项目如何找出性能瓶颈")]),t._v(" "),a("blockquote",[a("p",[t._v("https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/300")])]),t._v(" "),a("h2",{attrs:{id:"前端基建可以做哪些事情"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端基建可以做哪些事情"}},[t._v("#")]),t._v(" 前端基建可以做哪些事情？")]),t._v(" "),a("blockquote",[a("p",[t._v("https://juejin.cn/post/7256879435339628604")])]),t._v(" "),a("blockquote",[a("p",[t._v("来自 ChatGPT 的回答-～～ ⬇️ ⬇️ ⬇️")])]),t._v(" "),a("p",[t._v("前端基建是指在前端开发过程中，为提高开发效率、代码质量和团队协作而构建的一些基础设施和工具。下面是前端基建可以做的一些事情：")]),t._v(" "),a("ol",[a("li",[a("p",[a("code",[t._v("脚手架工具")]),t._v("：开发和维护一个通用的脚手架工具，可以帮助团队快速初始化项目结构、配置构建工具、集成常用的开发依赖等。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("组件库")]),t._v("：开发和维护一个内部的组件库，包含常用的 UI 组件、业务组件等，提供给团队成员复用，减少重复开发的工作量。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("构建工具和打包工具")]),t._v("：搭建和维护一套完善的构建和打包工具链，包括使用 Webpack、Parcel 等工具进行代码的压缩、合并、打包等工具，优化前端资源加载和性能。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("自动化测试工具")]),t._v("：引入自动化测试工具，如 Jest、Mocha 等，编写和维护测试用例，进行单元测试、集成测试、UI 测试等，提高代码质量和可靠性。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("文档工具")]),t._v("：使用工具如 JSDoc、Swagger 等，生成项目的 API 文档、接口文档等，方便团队成员查阅和维护。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("Git工作流")]),t._v("：制定和规范团队的 Git 工作流程，使用版本控制工具管理代码，方便团队协作和代码回退。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("性能监控和优化")]),t._v("：引入性能监控工具，如 Lighthouse、Web Vitals 等，对项目进行性能分析，优化网页加载速度、响应时间等。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("工程化规范")]),t._v("：制定并推广团队的代码规范、目录结构规范等，提高代码的可读性、可维护性和可扩展性。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("持续集成和部署")]),t._v("：搭建持续集成和部署系统，如 Jenkins、Travis CI 等，实现代码的自动构建、测试和部署，提高开发效率和代码质量。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("项目文档和知识库")]),t._v("：建立一个内部的项目文档和知识库，记录项目的技术细节、开发经验、常见问题等，方便团队成员查阅和学习。")])])]),t._v(" "),a("p",[t._v("通过建立和维护前端基建，可以提高团队的协作效率，减少重复劳动，提高代码质量和项目的可维护性。")]),t._v(" "),a("p",[t._v("当涉及到前端基建时，还有一些其他的事情可以考虑：")]),t._v(" "),a("ol",[a("li",[a("p",[a("code",[t._v("代码质量工具")]),t._v("：引入代码质量工具，如 ESLint、Prettier 等，对代码进行静态分析和格式化，提高代码的一致性和可读性。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("国际化支持")]),t._v("：为项目添加国际化支持，可以通过引入国际化库，如 i18next、vue-i18n 等，实现多语言的切换和管理。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("错误监控和日志收集")]),t._v("：引入错误监控工具，如 Sentry、Bugsnag 等，实时监控前端错误，并收集错误日志，方便进行问题排查和修复。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("前端性能优化工具")]),t._v("：使用工具如 WebPageTest、Chrome DevTools 等，对项目进行性能分析和优化，提高页面加载速度、响应时间等。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("缓存管理")]),t._v("：考虑合理利用浏览器缓存和服务端缓存，减少网络请求，提升用户访问速度和体验。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("移动端适配")]),t._v("：针对移动端设备，采用响应式设计或使用 CSS 媒体查询等技术，实现移动端适配，保证页面在不同尺寸的设备上有良好的显示效果。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("安全防护")]),t._v("：对项目进行安全审计，使用安全防护工具，如 CSP（Content Security Policy）、XSS 过滤等，保护网站免受常见的安全攻击。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("性能优化指标监控")]),t._v("：监控和分析关键的性能指标，如页面加载时间、首次渲染时间、交互响应时间等，以便及时发现和解决性能问题。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("前端日志分析")]),t._v("：使用日志分析工具，如 ELK（Elasticsearch、Logstash、Kibana）等，对前端日志进行收集和分析，了解用户行为和页面异常情况。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("跨平台开发")]),t._v("：考虑使用跨平台开发框架，如 React Native、Flutter 等，实现一套代码在多个平台上复用，提高开发效率。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("编辑器配置和插件")]),t._v("：为团队提供统一的编辑器配置文件，包括代码格式化、语法高亮、代码自动补全等，并推荐常用的编辑器插件，提高开发效率。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("文档生成工具")]),t._v("：使用工具如 Docusaurus、VuePress 等，为项目生成漂亮的文档网站，方便团队成员查阅和维护项目文档。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("Mock数据和接口管理")]),t._v("：搭建一个 Mock 服务器，用于模拟后端接口数据，方便前端开发和测试，同时可以考虑使用接口管理工具，如 Swagger 等，方便接口的定义和调试。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("前端监控和统计")]),t._v("：引入前端监控工具，如 Google Analytics、百度统计等，收集用户访问数据和行为信息，用于分析和优化用户体验。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("移动端调试工具")]),t._v("：使用工具如 Eruda、VConsole 等，帮助在移动端设备上进行调试和错误排查，提高开发效率。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("自动化部署")]),t._v("：配置自动化部署流程，将项目的代码自动部署到服务器或云平台，减少人工操作，提高发布效率和稳定性。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("前端团队协作工具")]),t._v("：使用团队协作工具，如 GitLab、Bitbucket 等，提供代码托管、项目管理、任务分配和团队沟通等功能，增强团队协作效率。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("前端培训和知识分享")]),t._v("：组织定期的前端培训和技术分享会，让团队成员相互学习和交流，推动技术的共享和提升。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("客户端性能优化")]),t._v("：针对移动端应用，可以使用工具如 React Native Performance、Weex 等，进行客户端性能优化，提高应用的响应速度和流畅度。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("技术选型和评估")]),t._v("：定期评估和研究前端技术的发展趋势，选择适用的技术栈和框架，以保持项目的竞争力和可持续发展。")])])]),t._v(" "),a("p",[t._v("以上是一些可以考虑的前端基建事项，根据项目需求和团队情况，可以选择适合的工具和技术进行实施。同时，持续关注前端领域的最新技术和工具，不断优化和改进前端基建，以提高开发效率和项目质量。")]),t._v(" "),a("p",[t._v("当涉及到前端基建时，还有一些其他的事情可以考虑：")]),t._v(" "),a("ol",[a("li",[a("p",[a("code",[t._v("统一的状态管理")]),t._v("：引入状态管理工具，如 Redux、Vuex 等，帮助团队管理前端应用的状态，提高代码的可维护性和可扩展性。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("前端日志记录")]),t._v("：引入前端日志记录工具，如 log4javascript、logrocket 等，记录前端应用的运行日志，方便排查和解决问题。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("前端代码扫描")]),t._v("：使用静态代码扫描工具，如 SonarQube、CodeClimate 等，对前端代码进行扫描和分析，发现潜在的问题和漏洞。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("前端数据可视化")]),t._v("：使用数据可视化工具，如 ECharts、Chart.js 等，将数据以图表或图形的形式展示，增强数据的可理解性和可视化效果。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("前端容灾和故障处理")]),t._v("：制定容灾方案和故障处理流程，对前端应用进行监控和预警，及时处理和恢复故障，提高系统的可靠性和稳定性。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("前端安全加固")]),t._v("：对前端应用进行安全加固，如防止 XSS 攻击、CSRF 攻击、数据加密等，保护用户数据的安全性和隐私。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("前端版本管理")]),t._v("：建立前端代码的版本管理机制，使用工具如 Git、SVN 等，管理和追踪代码的变更，方便团队成员之间的协作和版本控制。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("前端数据缓存")]),t._v("：考虑使用 Local Storage、Session Storage 等技术，对一些频繁使用的数据进行缓存，提高应用的性能和用户体验。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("前端代码分割")]),t._v("：使用代码分割技术，如 Webpack 的动态导入（Dynamic Import），将代码按需加载，减少初始加载的资源大小，提高页面加载速度。")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("前端性能监测工具")]),t._v("：使用性能监测工具，如 WebPageTest、GTmetrix 等，监测前端应用的性能指标，如页面加载时间、资源加载时间等，进行性能优化。")])])]),t._v(" "),a("p",[t._v("以上是一些可以考虑的前端基建事项，根据项目需求和团队情况，可以选择适合的工具和技术进行实施。同时，持续关注前端领域的最新技术和工具，不断优化和改进前端基建，以提高开发效率和项目质量。")]),t._v(" "),a("h2",{attrs:{id:"monorepo-vs-multirepo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#monorepo-vs-multirepo"}},[t._v("#")]),t._v(" Monorepo vs Multirepo")]),t._v(" "),a("p",[t._v('Monorepo 的全称是 monolithic repository，即单体式仓库，与之对应的是 Multirepo(multiple repository)，这里的"单"和"多"是指每个仓库中所管理的模块数量。')]),t._v(" "),a("p",[t._v("Multirepo 是比较传统的做法，即每一个 package 都单独用一个仓库来进行管理。例如：Rollup, ...")]),t._v(" "),a("p",[t._v("Monorep 是把所有相关的 package 都放在一个仓库里进行管理，"),a("strong",[t._v("每个 package 独立发布")]),t._v("。 例如：React, Angular, Babel, Jest, Umijs, Vue ...")]),t._v(" "),a("p",[t._v("一图胜千言：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2024/png/35183778/1704881983867-2fe043db-9da8-4f5b-b0a5-a51870da56b3.png",alt:""}})]),t._v(" "),a("p",[t._v("当然到底哪一种管理方式更好，仁者见仁，智者见智。前者允许多元化发展（各项目可以有自己的构建工具、依赖管理策略、单元测试方法），后者希望集中管理，减少项目间的差异带来的沟通成本。")]),t._v(" "),a("p",[t._v("虽然拆分子仓库、拆分子 npm 包是进行项目隔离的天然方案，但当仓库内容出现关联时，没有任何一种调试方式比源码放在一起更高效。")]),t._v(" "),a("p",[t._v("结合我们项目的实际场景和业务需要，天然的 MonoRepo ! 因为工程化的最终目的是让业务开发可以 100% 聚焦在业务逻辑上，那么这不仅仅是脚手架、框架需要从自动化、设计上解决的问题，这涉及到仓库管理的设计。")]),t._v(" "),a("p",[t._v("一个理想的开发环境可以抽象成这样：")]),t._v(" "),a("p",[t._v('"'),a("strong",[t._v("只关心业务代码，可以直接跨业务复用而不关心复用方式，调试时所有代码都在源码中。")]),t._v('"')]),t._v(" "),a("p",[t._v("在前端开发环境中，多 Git Repo，多 npm 则是这个理想的阻力，它们导致复用要关心版本号，调试需要 npm link。而这些是 MonoRepo 最大的优势。")]),t._v(" "),a("p",[t._v("上图中提到的利用相关工具就是今天的主角 Lerna ! Lerna 是业界知名度最高的 Monorepo 管理工具，功能完整。")]),t._v(" "),a("p",[a("strong",[t._v("单一仓库如何产出不同项目？")])]),t._v(" "),a("p",[t._v("简要思路：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("项目目录划分：在 packages 目录下管理需要复用的代码，如（utils 公共函数、components 公共组件、templates 公共模板、store 数据流层等），prd 目录下划分不同项目的页面文件夹")])]),t._v(" "),a("li",[a("p",[t._v("构建参数设计：区分运行环境、执行的 prd 子项目和配置文件（如 vue.config.js）")])]),t._v(" "),a("li",[a("p",[t._v("正确运行：通过 spawnSync 等进程执行工具运行 prd 子项目")])])]),t._v(" "),a("h2",{attrs:{id:"pnpm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pnpm"}},[t._v("#")]),t._v(" pnpm")]),t._v(" "),a("blockquote",[a("p",[t._v("https://pnpm.io/zh/")])]),t._v(" "),a("p",[t._v("pnpm 是新一代快速的，节省磁盘空间的包管理工具")]),t._v(" "),a("ul",[a("li",[t._v("快速: pnpm is up to 2x faster than npm")]),t._v(" "),a("li",[t._v("高效: node_modules 中的文件为复制或链接自特定的内容寻址存储库")]),t._v(" "),a("li",[t._v("严格: pnpm 默认创建了一个非平铺的 node_modules，因此代码无法访问任意包")])]),t._v(" "),a("p",[a("strong",[t._v("支持 monorepos")]),t._v(" :pnpm 内置支持单仓多包")]),t._v(" "),a("p",[t._v("pnpm 内置了对单一存储库（也称为多包存储库、多项目存储库或单体存储库）的支持， 你可以创建一个 "),a("a",{attrs:{href:"https://pnpm.io/zh/workspaces",target:"_blank",rel:"noopener noreferrer"}},[t._v("workspace"),a("OutboundLink")],1),t._v(" 以将多个项目合并到一个仓库中。")]),t._v(" "),a("p",[t._v("pnpm 版本兼容性: https://pnpm.io/zh/installation#%E5%85%BC%E5%AE%B9%E6%80%A7")]),t._v(" "),a("p",[t._v("pnpm 的命令,以下是简便的 npm 命令等效列表：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("npm 命令")]),t._v(" "),a("th",[t._v("pnpm 等效")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("npm install")])]),t._v(" "),a("td",[a("a",{attrs:{href:"https://pnpm.io/zh/cli/install",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("pnpm install")]),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("npm i <pkg>")])]),t._v(" "),a("td",[a("a",{attrs:{href:"https://pnpm.io/zh/cli/add",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("pnpm add <pkg>")]),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("npm run <cmd>")])]),t._v(" "),a("td",[a("a",{attrs:{href:"https://pnpm.io/zh/cli/run",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("pnpm <cmd>")]),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("npm uninstall <cmd>")])]),t._v(" "),a("td",[a("a",{attrs:{href:"https://pnpm.io/zh/cli/remove",target:"_blank",rel:"noopener noreferrer"}},[a("code",[t._v("pnpm remove <cmd>")]),a("OutboundLink")],1)])])])]),t._v(" "),a("h2",{attrs:{id:"谈谈微前端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#谈谈微前端"}},[t._v("#")]),t._v(" 谈谈微前端")]),t._v(" "),a("p",[t._v("微前端就是微服务在前端的应用，也就是前端微服务.")]),t._v(" "),a("h4",{attrs:{id:"如果使用微服务来重构整个应用有什么好处"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如果使用微服务来重构整个应用有什么好处"}},[t._v("#")]),t._v(" 如果使用微服务来重构整个应用有什么好处？")]),t._v(" "),a("p",[t._v("一个应用分解成多个服务，每个服务独自服务内部的功能。例如原来的应用有 abcd 四个页面，现在分解成两个服务，第一个服务有 ab 两个页面，第二个服务有 cd 两个页面，组合在一起就和原来的应用一样。")]),t._v(" "),a("p",[t._v("当应用其中一个服务出故障时，其他服务仍可以正常访问。例如第一个服务出故障了， ab 页面将无法访问，但 cd 页面仍能正常访问。")]),t._v(" "),a("p",[t._v("好处：不同的服务独立运行，服务与服务之间解耦。我们可以把服务理解成组件，就像本小书第 3 章《前端组件化》中所说的一样。每个服务可以独自管理，修改一个服务不影响整体应用的运行，只影响该服务提供的功能。")]),t._v(" "),a("p",[t._v("另外在开发时也可以快速的添加、删除功能。例如电商网站，在不同的节假日时推出的活动页面，活动过后马上就可以删掉。")]),t._v(" "),a("p",[t._v("难点：不容易确认服务的边界。当一个应用功能太多时，往往多个功能点之间的关联会比较深。因而就很难确定这一个功能应该归属于哪个服务。")]),t._v(" "),a("ul",[a("li",[t._v("https://woai3c.github.io/introduction-to-front-end-engineering/11.html")])]),t._v(" "),a("p",[t._v("现在我们将使用微前端框架  "),a("a",{attrs:{href:"https://qiankun.umijs.org/zh/guide",target:"_blank",rel:"noopener noreferrer"}},[t._v("qiankun"),a("OutboundLink")],1),t._v("来构建一个微前端应用。之所以选用 qiankun 框架，是因为它有以下几个优点：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("技术栈无关，任何技术栈的应用都能接入。")])]),t._v(" "),a("li",[a("p",[t._v("样式隔离，子应用之间的样式互不干扰。")])]),t._v(" "),a("li",[a("p",[t._v("子应用的 JavaScript 作用域互相隔离。")])]),t._v(" "),a("li",[a("p",[t._v("资源预加载，在浏览器空闲时间预加载未打开的微应用资源，加速微应用打开速度。")])]),t._v(" "),a("li",[a("p",[a("a",{attrs:{href:"https://github.com/woai3c/micro-frontend-demo/tree/main",target:"_blank",rel:"noopener noreferrer"}},[t._v("微前端 demo"),a("OutboundLink")],1)])])]),t._v(" "),a("h2",{attrs:{id:"前端监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端监控"}},[t._v("#")]),t._v(" 前端监控")]),t._v(" "),a("blockquote",[a("p",[t._v("https://woai3c.github.io/introduction-to-front-end-engineering/07.html")])]),t._v(" "),a("h3",{attrs:{id:"什么时候需要监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么时候需要监控"}},[t._v("#")]),t._v(" 什么时候需要监控")]),t._v(" "),a("ol",[a("li",[t._v("当你的应用频繁报错找不到原因的时候。(集成性能监控的探针 sdk, 收集错误信息)")]),t._v(" "),a("li",[t._v("需要分析用户兴趣爱好、购买习惯。 (集成神策埋点, 收集自定义事件, 通过 PV UV 用户点击,页面跳转等事件漏斗进行统计分析)")]),t._v(" "),a("li",[t._v("需要优化程序的时候，可以做监控收集数据，做针对性的优化。(集成性能监控的探针 sdk, 性能分析)")]),t._v(" "),a("li",[t._v("需要保证服务可靠性稳定性。(集成性能监控的探针 sdk)")])]),t._v(" "),a("p",[t._v("如果你的应用符合以上任意一条，就可以对应用实行监控了。监控的作用有两个：事前预警和事后分析。")]),t._v(" "),a("p",[t._v("事前预警：提前设置一个阈值，当监控的数据达到阈值时，通过短信或者邮件通知管理员。例如 API 请求数量突然间暴涨，就得进行报警，否则可能会造成服务器宕机。")]),t._v(" "),a("p",[t._v("事后分析：通过监控日志文件，分析故障原因和故障发生点。从而做出修改，防止这种情况再次发生。")]),t._v(" "),a("p",[t._v("本章内容分为前端监控原理分析和如何对项目实行监控两个部分。第一部分是讲如何写一个简易的监控 SDK，第二部分是讲如何使用  "),a("a",{attrs:{href:"https://docs.sentry.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("sentry"),a("OutboundLink")],1),t._v("实现项目监控。")]),t._v(" "),a("p",[t._v("好了，下面让我们开始进入正文吧。")]),t._v(" "),a("p",[t._v("一个完整的前端监控平台包括三个部分：数据采集与上报、数据整理和存储、数据展示。")]),t._v(" "),a("p",[t._v("本章要讲的就是其中的第一个环节------数据采集与上报。下图是本章要讲述内容的大纲，大家可以先大致了解一下：")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/b1503db00065b0bde7edd1b45abd1f85.png",alt:"image.png"}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/img_convert/b35bc4f1cdd718025cf39818772ad761.png",alt:"image.png"}})]),t._v(" "),a("p",[t._v("仅看理论知识是比较难以理解的，为此我结合本章要讲的技术要点写了一个简单的"),a("a",{attrs:{href:"https://github.com/woai3c/monitor-demo",target:"_blank",rel:"noopener noreferrer"}},[t._v("监控 SDK"),a("OutboundLink")],1),t._v("，可以用它来写一些简单的 DEMO，帮助加深理解。再结合本章一起阅读，效果更好。")]),t._v(" "),a("h3",{attrs:{id:"性能数据采集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#性能数据采集"}},[t._v("#")]),t._v(" 性能数据采集")]),t._v(" "),a("p",[t._v("chrome 开发团队提出了一系列用于检测网页性能的指标：")]),t._v(" "),a("ul",[a("li",[t._v("FP(first-paint)，从页面加载开始到第一个像素绘制到屏幕上的时间")]),t._v(" "),a("li",[t._v("FCP(first-contentful-paint)，从页面加载开始到页面内容的任何部分在屏幕上完成渲染的时间")]),t._v(" "),a("li",[t._v("LCP(largest-contentful-paint)，从页面加载开始到最大文本块或图像元素在屏幕上完成渲染的时间")]),t._v(" "),a("li",[t._v("CLS(layout-shift)，从页面加载开始和其"),a("a",{attrs:{href:"https://developers.google.com/web/updates/2018/07/page-lifecycle-api",target:"_blank",rel:"noopener noreferrer"}},[t._v("生命周期状态"),a("OutboundLink")],1),t._v("变为隐藏期间发生的所有意外布局偏移的累积分数")])]),t._v(" "),a("p",[t._v("这四个性能指标都需要通过  "),a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/PerformanceObserver",target:"_blank",rel:"noopener noreferrer"}},[t._v("PerformanceObserver"),a("OutboundLink")],1),t._v("来获取（也可以通过  "),a("code",[t._v("performance.getEntriesByName()")]),t._v("  获取，但它不是在事件触发时通知的）。PerformanceObserver 是一个性能监测对象，用于监测性能度量事件。")]),t._v(" "),a("h3",{attrs:{id:"错误数据采集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误数据采集"}},[t._v("#")]),t._v(" 错误数据采集")]),t._v(" "),a("ol",[a("li",[t._v("资源加载错误: 使用 addEventListener() 监听 error 事件，可以捕获到资源加载失败错误。")]),t._v(" "),a("li",[t._v("js 错误: 使用 window.onerror 可以监听 js 错误。")]),t._v(" "),a("li",[t._v("promise 错误: 使用 addEventListener() 监听 unhandledrejection 事件，可以捕获到未处理的 promise 错误。")]),t._v(" "),a("li",[t._v("生产报错信息还原: 使用 source-map.")]),t._v(" "),a("li",[t._v("Vue 错误: 利用 window.onerror 是捕获不到 Vue 错误的，它需要使用 Vue 提供的 API 进行监听。 "),a("code",[t._v("Vue.config.errorHandler")])])]),t._v(" "),a("h3",{attrs:{id:"数据上报"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据上报"}},[t._v("#")]),t._v(" 数据上报")]),t._v(" "),a("p",[a("strong",[t._v("上报方法")])]),t._v(" "),a("p",[t._v("数据上报可以使用以下几种方式：")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/Navigator/sendBeacon",target:"_blank",rel:"noopener noreferrer"}},[t._v("sendBeacon"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest",target:"_blank",rel:"noopener noreferrer"}},[t._v("XMLHttpRequest"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("image")])]),t._v(" "),a("p",[t._v("我写的简易 SDK 采用的是第一、第二种方式相结合的方式进行上报。利用 sendBeacon 来进行上报的优势非常明显。")]),t._v(" "),a("blockquote",[a("p",[t._v("使用  "),a("code",[t._v("sendBeacon()")]),t._v("  方法会使用户代理在有机会时异步地向服务器发送数据，同时不会延迟页面的卸载或影响下一导航的载入性能。这就解决了提交分析数据时的所有的问题：数据可靠，传输异步并且不会影响下一页面的加载。")])]),t._v(" "),a("p",[t._v("在不支持 sendBeacon 的浏览器下我们可以使用 XMLHttpRequest 来进行上报。一个 HTTP 请求包含发送和接收两个步骤。其实对于上报来说，我们只要确保能发出去就可以了。也就是发送成功了就行，接不接收响应无所谓。为此，我做了个实验，在 beforeunload 用 XMLHttpRequest 传送了 30kb 的数据（一般的待上报数据很少会有这么大），换了不同的浏览器，都可以成功发出去。当然，这和硬件性能、网络状态也是有关联的。")]),t._v(" "),a("p",[a("strong",[t._v("上报时机")])]),t._v(" "),a("p",[t._v("上报时机有三种：")]),t._v(" "),a("ol",[a("li",[t._v("采用  "),a("code",[t._v("requestIdleCallback/setTimeout")]),t._v("  延时上报。")]),t._v(" "),a("li",[t._v("在  "),a("code",[t._v("beforeunload()")]),t._v("  回调函数里上报。")]),t._v(" "),a("li",[t._v("缓存上报数据，达到一定数量后再上报。")])]),t._v(" "),a("p",[t._v("建议将三种方式结合一起上报：")]),t._v(" "),a("ol",[a("li",[t._v("先缓存上报数据，缓存到一定数量后，利用  "),a("code",[t._v("requestIdleCallback/setTimeout")]),t._v("  延时上报。")]),t._v(" "),a("li",[t._v("在页面离开时统一将未上报的数据进行上报。")])]),t._v(" "),a("p",[a("strong",[t._v("上报时机代码参考")])]),t._v(" "),a("ul",[a("li",[t._v("https://github.com/woai3c/monitor-demo/blob/main/src/utils/report.js")])]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" originalOpen"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" originalSend "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./xhr'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" addCache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" getCache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" clearCache "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./cache'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" generateUniqueID "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../utils/generateUniqueID'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" config "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'../config'")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isSupportSendBeacon")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("navigator"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?.")]),t._v("sendBeacon\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sendBeacon "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("isSupportSendBeacon")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("navigator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendBeacon")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("navigator"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" reportWithXHR\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sessionID "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("generateUniqueID")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("report")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" isImmediate "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'请设置上传 url 地址'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" reportData "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" sessionID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("appID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("appID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("userID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("userID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    data\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("isImmediate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendBeacon")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reportData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("requestIdleCallback"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("requestIdleCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendBeacon")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reportData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("timeout")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sendBeacon")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reportData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" timer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("lazyReportCache")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" timeout "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("addCache")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("clearTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("timer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  timer "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" data "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getCache")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("report")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("clearCache")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" timeout"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("reportWithXHR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" xhr "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("XMLHttpRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("originalOpen")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'post'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("originalSend")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("call")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("xhr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"前端监控部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端监控部署"}},[t._v("#")]),t._v(" 前端监控部署")]),t._v(" "),a("p",[t._v("前面说的都是监控原理，但要实现还是得自己动手写代码。为了避免麻烦，我们可以用现有的工具  "),a("a",{attrs:{href:"https://docs.sentry.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("sentry"),a("OutboundLink")],1),t._v("去做这件事。")]),t._v(" "),a("p",[t._v("sentry 是一个用 python 写的性能和错误监控工具，你可以使用 sentry 提供的服务（免费功能少），也可以自己部署服务.")]),t._v(" "),a("h2",{attrs:{id:"nginx"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx"}},[t._v("#")]),t._v(" Nginx")]),t._v(" "),a("p",[t._v("轻量级、高性能的 Web 服务器，在现今的大型应用、网站基本都离不开 Nginx，已经成为了一项必选的技术；其实可以把它理解成 "),a("strong",[t._v("入口网关")]),t._v("，这里我举个例子可能更好理解:")]),t._v(" "),a("blockquote",[a("p",[t._v("当你去银行办理业务时，刚走进银行，需要到入门处的机器排队取号，然后按指令到对应的柜台办理业务，或者也有可能告诉你，今天不能排号了，回家吧！")]),t._v(" "),a("p",[t._v("这样一个场景中，"),a("strong",[t._v("取号机器就是 Nginx(入口网关)")]),t._v("。一个个柜台就是我们的业务服务器(办理业务)；银行中的保险箱就是我们的数据库(存取数据)；🤣")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/xd-tayde/blog/blob/master/images/interview/10.png",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://github.com/xd-tayde/blog/raw/master/images/interview/10.png",alt:""}}),a("OutboundLink")],1)]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("特点")]),t._v(":")]),t._v(" "),a("ul",[a("li",[t._v("轻量级，配置方便灵活，无侵入性；")]),t._v(" "),a("li",[t._v("占用内存少，启动快，性能好；")]),t._v(" "),a("li",[t._v("高并发，事件驱动，异步；")]),t._v(" "),a("li",[t._v("热部署，修改配置热生效；")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("架构模型")]),t._v(":")]),t._v(" "),a("ul",[a("li",[t._v("基于 "),a("strong",[t._v("socket 与 Linux epoll (I/O 事件通知机制)")]),t._v("，实现了 "),a("strong",[t._v("高并发")]),t._v("；\n"),a("ul",[a("li",[t._v("使用模块化、事件通知、回调函数、计时器、轮询实现非阻塞的异步模式；")]),t._v(" "),a("li",[t._v("磁盘不足的情况，可能会导致阻塞；")])])]),t._v(" "),a("li",[a("strong",[t._v("Master-worker 进程模式")]),t._v(":\n"),a("ul",[a("li",[t._v("Nginx 启动时会在内存中常驻一个 "),a("strong",[t._v("Master 主进程")]),t._v("，功能:\n"),a("ul",[a("li",[t._v("读取配置文件；")]),t._v(" "),a("li",[t._v("创建、绑定、关闭 socket；")]),t._v(" "),a("li",[t._v("启动、维护、配置 worker 进程；")]),t._v(" "),a("li",[t._v("编译脚本、打开日志；")])])]),t._v(" "),a("li",[t._v("master 进程会开启配置数量的 "),a("strong",[t._v("worker 进程")]),t._v("，比如根据 CPU 核数等:\n"),a("ul",[a("li",[t._v("利用 socket 监听连接，不会新开进程或线程，节约了创建与销毁进程的成本；")]),t._v(" "),a("li",[t._v("检查网络、存储，把新连接加入到轮询队列中，异步处理；")]),t._v(" "),a("li",[t._v("能有效利用 cpu 多核，并避免了线程切换和锁等待；")])])])])]),t._v(" "),a("li",[a("strong",[t._v("热部署模式")]),t._v(":\n"),a("ul",[a("li",[t._v("当我们修改配置热重启后，master 进程会以新的配置新创建 worker 进程，新连接会全部交给新进程处理；")]),t._v(" "),a("li",[t._v("老的 worker 进程会在处理完之前的连接后被 kill 掉，逐步全替换成新配置的 worker 进程；")])])])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("配置")]),t._v(":")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("官网下载；")])]),t._v(" "),a("li",[a("p",[t._v("配置文件路径： "),a("code",[t._v("/usr/local/etc/nginx/nginx.conf")]),t._v("；")])]),t._v(" "),a("li",[a("p",[t._v("启动: 终端输入 "),a("code",[t._v("nginx")]),t._v("，访问 "),a("code",[t._v("localhost:8080")]),t._v(" 就能看到 "),a("code",[t._v("Welcome...")]),t._v("；")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("nginx -s stop")]),t._v(": 停止服务；")])]),t._v(" "),a("li",[a("p",[a("code",[t._v("nginx -s reload")]),t._v(": 热重启服务；")])]),t._v(" "),a("li",[a("p",[t._v("配置代理: "),a("code",[t._v("proxy_pass")])]),t._v(" "),a("ul",[a("li",[t._v("在配置文件中配置即可完成；")])]),t._v(" "),a("div",{staticClass:"language-source-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" server {\n     listen 80;\n     location / {\n         proxy_pass http://xxx.xxx.xx.xx:3000;\n     }\n }\n")])])])])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("常用场景")]),t._v(":")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("代理")]),t._v(":")]),t._v(" "),a("ul",[a("li",[t._v("其实 Nginx 可以算一层 "),a("strong",[t._v("代理服务器")]),t._v("，将客户端的请求处理一层后，再转发到业务服务器，这里可以分成两种类型，其实实质就是 "),a("strong",[t._v("请求的转发")]),t._v("，使用 Nginx 非常合适、高效；")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("正向代理")]),t._v(":")]),t._v(" "),a("ul",[a("li",[t._v("即用户通过访问这层正向代理服务器，再由代理服务器去到原始服务器请求内容后，再返回给用户；")]),t._v(" "),a("li",[t._v("例如我们常使用的 VPN 就是一种常见的正向代理模式。通常我们无法直接访问谷歌服务器，但是通过访问一台国外的服务器，再由这台服务器去请求谷歌返回给用户，用户即可访问谷歌；")]),t._v(" "),a("li",[a("strong",[t._v("特点")]),t._v(":\n"),a("ul",[a("li",[t._v("代理服务器属于 "),a("strong",[t._v("客户端层")]),t._v("，称之为正向代理；")]),t._v(" "),a("li",[t._v("代理服务器是 "),a("strong",[t._v("为用户服务")]),t._v("，对于用户是透明的，用户知道自己访问代理服务器；")]),t._v(" "),a("li",[t._v("对内容服务器来说是 "),a("strong",[t._v("隐藏")]),t._v(" 的，内容服务器并无法分清访问是来自用户或者代理；"),a("a",{attrs:{href:"https://github.com/xd-tayde/blog/blob/master/images/interview/11.png",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://github.com/xd-tayde/blog/raw/master/images/interview/11.png",alt:""}}),a("OutboundLink")],1)])])])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("反向代理")]),t._v(":")]),t._v(" "),a("ul",[a("li",[t._v("用户访问头条的反向代理网关，通过网关的一层处理和调度后，再由网关将访问转发到内部的服务器上，返回内容给用户；")]),t._v(" "),a("li",[a("strong",[t._v("特点")]),t._v(":\n"),a("ul",[a("li",[t._v("代理服务器属于 "),a("strong",[t._v("服务端层")]),t._v("，因此称为反向代理。通常代理服务器与内部内容服务器会隶属于同一内网或者集群；")]),t._v(" "),a("li",[t._v("代理服务器是 "),a("strong",[t._v("为内容服务器服务")]),t._v(" 的，对用户是隐藏的，用户不清楚自己访问的具体是哪台内部服务器；")]),t._v(" "),a("li",[t._v("能有效保证内部服务器的 "),a("strong",[t._v("稳定与安全")]),t._v("；"),a("a",{attrs:{href:"https://github.com/xd-tayde/blog/blob/master/images/interview/12.png",target:"_blank",rel:"noopener noreferrer"}},[a("img",{attrs:{src:"https://github.com/xd-tayde/blog/raw/master/images/interview/12.png",alt:""}}),a("OutboundLink")],1)])])])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("反向代理的好处")]),t._v(":")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("安全与权限")]),t._v(":\n"),a("ul",[a("li",[t._v("用户访问必须通过反向代理服务器，也就是便可以在做这层做统一的请求校验，过滤拦截不合法、危险的请求，从而就能更好的保证服务器的安全与稳定；")])])]),t._v(" "),a("li",[a("strong",[t._v("负载均衡")]),t._v(": 能有效分配流量，最大化集群的稳定性，保证用户的访问质量；")])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("负载均衡")]),t._v(":")]),t._v(" "),a("ul",[a("li",[t._v("负载均衡是基于反向代理下实现的一种 "),a("strong",[t._v("流量分配")]),t._v(" 功能，目的是为了达到服务器资源的充分利用，以及更快的访问响应；")]),t._v(" "),a("li",[t._v("其实很好理解，还是以上面银行的例子来看: "),a("strong",[t._v("通过门口的取号器，系统就可以根据每个柜台的业务排队情况进行用户的分，使每个柜台都保持在一个比较高效的运作状态，避免出现分配不均的情况")]),t._v("；")]),t._v(" "),a("li",[t._v("由于用户并不知道内部服务器中的队列情况，而反向代理服务器是清楚的，因此通过 Nginx，便能很简单地实现流量的均衡分配；")]),t._v(" "),a("li",[t._v("Nginx 实现: "),a("code",[t._v("Upstream")]),t._v("模块， 这样当用户访问 "),a("code",[t._v("http://xxx")]),t._v(" 时，流量便会被按照一定的规则分配到"),a("code",[t._v("upstream")]),t._v("中的3台服务器上；")])]),t._v(" "),a("div",{staticClass:"language-source-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" http {\n     upstream xxx {\n         server 1.1.1.1:3001;\n         server 2.2.2.2:3001;\n         server 3.3.3.3:3001;\n     }\n     server {\n         listen 8080;\n         location / {\n             proxy_pass http://xxx;\n         }\n     }\n }\n")])])]),a("ul",[a("li",[a("p",[a("strong",[t._v("分配策略")]),t._v(":")]),t._v(" "),a("ul",[a("li",[a("p",[a("strong",[t._v("服务器权重("),a("code",[t._v("weight")]),t._v(")")]),t._v(":")]),t._v(" "),a("ul",[a("li",[t._v("可以为每台服务器配置访问权重，传入参数"),a("code",[t._v("weight")]),t._v("，例如:")])]),t._v(" "),a("div",{staticClass:"language-source-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("  upstream xxx {\n     server 1.1.1.1:3001 weight=1;\n     server 2.2.2.2:3001 weight=1;\n     server 3.3.3.3:3001 weight=8;\n }\n")])])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("时间顺序(默认)")]),t._v(": 按用户的访问的顺序逐一的分配到正常运行的服务器上；")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("连接数优先("),a("code",[t._v("least_conn")]),t._v(")")]),t._v(": 优先将访问分配到列表中连接数队列最短的服务器上；")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("响应时间优先("),a("code",[t._v("fair")]),t._v(")")]),t._v(": 优先将访问分配到列表中访问响应时间最短的服务器上；")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("ip_hash")]),t._v(": 通过 ip_hash 指定，使每个 ip 用户都访问固定的服务器上，有利于用户特异性数据的缓存，例如本地 session 服务等；")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("url_hash")]),t._v(": 通过 url_hash 指定，使每个 url 都分配到固定的服务器上，有利于缓存；")])])])])])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("Nginx 对于前端的作用")]),t._v(":")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("1. 快速配置静态服务器")]),t._v("，当访问 "),a("code",[t._v("localhost:80")]),t._v(" 时，就会默认访问到 "),a("code",[t._v("/Users/files/index.html")]),t._v("；")])]),t._v(" "),a("div",{staticClass:"language-source-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" server {\n \tlisten 80;\n \tserver_name localhost;\n\n \tlocation / {\n \t\troot   /Users/files;\n \t\tindex  index.html;\n \t}\n }\n")])])]),a("ul",[a("li",[a("strong",[t._v("2. 访问限制")]),t._v(": 可以制定一系列的规则进行访问的控制，例如直接通过 ip 限制:")])]),t._v(" "),a("div",{staticClass:"language-source-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" # 屏蔽 192.168.1.1 的访问；\n # 允许 192.168.1.2 ~ 10 的访问；\n location / {\n     deny  192.168.1.1;\n     allow 192.168.1.2/10;\n     deny  all;\n }\n")])])]),a("ul",[a("li",[a("strong",[t._v("3. 解决跨域")]),t._v(": 其实跨域是 "),a("strong",[t._v("浏览器的安全策略")]),t._v("，这意味着只要不是通过浏览器，就可以绕开跨域的问题。所以只要通过在同域下启动一个 Nginx 服务，转发请求即可；")])]),t._v(" "),a("div",{staticClass:"language-source-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" location ^~/api/ {\n\t\t # 重写请求并代理到对应域名下\n     rewrite ^/api/(.*)$ /$1 break;\n     proxy_pass https://www.cross-target.com/;\n }\n")])])]),a("ul",[a("li",[a("p",[a("strong",[t._v("4. 图片处理")]),t._v(": 通过 ngx_http_image_filter_module 这个模块，可以作为一层图片服务器的代理，在访问的时候 "),a("strong",[t._v("对图片进行特定的操作，例如裁剪，旋转，压缩等")]),t._v("；")])]),t._v(" "),a("li",[a("p",[a("strong",[t._v("5. 本地代理，绕过白名单限制")]),t._v(": 例如我们在接入一些第三方服务时经常会有一些域名白名单的限制，如果我们在本地通过"),a("code",[t._v("localhost")]),t._v("进行开发，便无法完成功能。这里我们可以做一层本地代理，便可以直接通过指定域名访问本地开发环境；")])])]),t._v(" "),a("div",{staticClass:"language-source-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v(" server {\n listen 80;\n server_name www.toutiao.com;\n\n location / {\n     proxy_pass http://localhost:3000;\n }\n}\n")])])])])])])]),t._v(" "),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://woai3c.gitee.io/introduction-to-front-end-engineering/",target:"_blank",rel:"noopener noreferrer"}},[t._v("一本小书《带你入门前端工程》"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("https://github.com/xd-tayde/blog/blob/master/interview-3.md")])])])}),[],!1,null,null,null);a.default=n.exports}}]);